<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data-Driven Example</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Flowbite CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />

  <!-- Custom Design Tokens -->
  <link rel="stylesheet" href="../../design-system/colors.css">
  <link rel="stylesheet" href="../../design-system/spacing.css">
  <link rel="stylesheet" href="../../design-system/typography.css">

  <link rel="stylesheet" href="styles.css">
</head>

<body class="bg-gray-50 text-[var(--color-text)]">

  <!-- Navbar -->
  <nav class="bg-white border-b border-gray-200">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
      <a href="index.html" class="flex items-center space-x-3">
        <span class="self-center text-xl font-semibold whitespace-nowrap">My Prototype</span>
      </a>
      <div class="flex items-center space-x-3">
        <a href="index.html" class="text-gray-700 hover:text-blue-700 font-medium text-sm px-3 py-2">&larr; Back to Template</a>
        <a href="flowbite.html" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5">Flowbite Snippets</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-screen-xl mx-auto p-6">

    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">User Accounts</h1>
      <p class="text-gray-500">
        Data-driven table populated from <code class="text-sm bg-gray-100 px-1.5 py-0.5 rounded">data.json</code>. Edit the JSON file to change the data.
        To view this example, you need a local development server.  The quickest way to get this up and running 
         is with the <b><a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer" target="_blank">Live Server</a></b> 
         extension by Ritwick Dey. Once installed, Right-click index.html in the file 
       explorer and select "Open with Live Server".
      </p>
    </div>

    <!-- Search and Filter Bar -->
    <div class="bg-white border border-gray-200 rounded-lg p-4 mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div class="relative w-full sm:w-80">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
          <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </div>
        <input type="text" id="search-input" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5" placeholder="Search by name, email, or role...">
      </div>
      <div class="flex items-center gap-3">
        <select id="role-filter" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5">
          <option value="">All Roles</option>
          <option value="Admin">Admin</option>
          <option value="Designer">Designer</option>
          <option value="Developer">Developer</option>
          <option value="Product Manager">Product Manager</option>
        </select>
        <span id="result-count" class="text-sm text-gray-500 whitespace-nowrap"></span>
      </div>
    </div>

    <!-- Table -->
    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left text-gray-500">
          <thead class="text-xs text-gray-700 uppercase bg-gray-50">
            <tr>
              <th scope="col" class="px-6 py-3">Last Name</th>
              <th scope="col" class="px-6 py-3">First Name</th>
              <th scope="col" class="px-6 py-3">User ID</th>
              <th scope="col" class="px-6 py-3">Email Address</th>
              <th scope="col" class="px-6 py-3">Role</th>
              <th scope="col" class="px-6 py-3 text-right">Actions</th>
            </tr>
          </thead>
          <tbody id="user-table-body">
            <!-- Rows populated from data.json -->
          </tbody>
        </table>
      </div>

      <!-- Empty state (shown when no results match) -->
      <div id="empty-state" class="hidden p-12 text-center">
        <svg class="mx-auto mb-3 w-10 h-10 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <p class="text-gray-400 text-sm">No users match your search.</p>
      </div>
    </div>

    <!-- How It Works -->
    <div class="mt-10 bg-white border border-gray-200 rounded-lg p-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-3">How this example works</h2>
      <ol class="list-decimal list-inside space-y-2 text-sm text-gray-600">
        <li>Mock data lives in <code class="bg-gray-100 px-1.5 py-0.5 rounded">data.json</code> as a simple array of objects.</li>
        <li>On page load, <code class="bg-gray-100 px-1.5 py-0.5 rounded">script.js</code> fetches the JSON and renders one table row per record.</li>
        <li>The search bar and role filter narrow results in real time.</li>
        <li>Edit and Delete buttons fire placeholder actions you can customize.</li>
      </ol>
      <p class="mt-4 text-sm text-gray-500">To adapt this for your prototype, replace the data in <code class="bg-gray-100 px-1.5 py-0.5 rounded">data.json</code> with your own fields and update the table columns to match.</p>

      <details class="mt-4 bg-gray-900 rounded-lg">
        <summary class="text-green-400 text-sm font-mono px-4 py-3 cursor-pointer hover:bg-gray-800 rounded-lg">View data.json structure</summary>
        <pre class="text-gray-300 text-sm p-4 overflow-x-auto"><code>{
  "users": [
    {
      "id": "USR-1001",
      "firstName": "Maria",
      "lastName": "Chen",
      "email": "maria.chen@company.com",
      "role": "Admin"
    },
    ...
  ]
}</code></pre>
      </details>

      <details class="mt-3 bg-gray-900 rounded-lg">
        <summary class="text-green-400 text-sm font-mono px-4 py-3 cursor-pointer hover:bg-gray-800 rounded-lg">View key JavaScript (fetch + render)</summary>
        <pre class="text-gray-300 text-sm p-4 overflow-x-auto"><code>// Fetch the JSON data
const response = await fetch('data.json');
const data = await response.json();

// Render a table row for each user
function renderTable(users) {
  tableBody.innerHTML = users.map(user =&gt; `
    &lt;tr class="bg-white border-b hover:bg-gray-50"&gt;
      &lt;td class="px-6 py-4 font-medium text-gray-900"&gt;${user.lastName}&lt;/td&gt;
      &lt;td class="px-6 py-4"&gt;${user.firstName}&lt;/td&gt;
      &lt;td class="px-6 py-4"&gt;
        &lt;code class="text-xs bg-gray-100 px-1.5 py-0.5 rounded"&gt;${user.id}&lt;/code&gt;
      &lt;/td&gt;
      &lt;td class="px-6 py-4"&gt;${user.email}&lt;/td&gt;
      &lt;td class="px-6 py-4"&gt;
        &lt;span class="... rounded"&gt;${user.role}&lt;/span&gt;
      &lt;/td&gt;
      &lt;td class="px-6 py-4 text-right"&gt;
        &lt;button class="text-blue-600 hover:underline"&gt;Edit&lt;/button&gt;
        &lt;button class="text-red-600 hover:underline"&gt;Delete&lt;/button&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  `).join('');
}</code></pre>
      </details>
    </div>

  </main>

  <!-- Edit Modal -->
  <div id="edit-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-lg max-h-full">
      <div class="relative bg-white rounded-lg shadow">
        <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t">
          <h3 class="text-lg font-semibold text-gray-900">Edit User</h3>
          <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center" data-modal-hide="edit-modal">
            <svg class="w-3 h-3" fill="none" viewBox="0 0 14 14"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/></svg>
          </button>
        </div>
        <form id="edit-form" class="p-4 md:p-5 space-y-4">
          <input type="hidden" id="edit-id">
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="edit-firstName" class="block mb-2 text-sm font-medium text-gray-900">First Name</label>
              <input type="text" id="edit-firstName" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
            </div>
            <div>
              <label for="edit-lastName" class="block mb-2 text-sm font-medium text-gray-900">Last Name</label>
              <input type="text" id="edit-lastName" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
            </div>
          </div>
          <div>
            <label for="edit-email" class="block mb-2 text-sm font-medium text-gray-900">Email Address</label>
            <input type="email" id="edit-email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
          </div>
          <div>
            <label for="edit-role" class="block mb-2 text-sm font-medium text-gray-900">Role</label>
            <select id="edit-role" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
              <option value="Admin">Admin</option>
              <option value="Designer">Designer</option>
              <option value="Developer">Developer</option>
              <option value="Product Manager">Product Manager</option>
            </select>
          </div>
          <div class="flex items-center pt-2 border-t border-gray-200">
            <button type="submit" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5">Save Changes</button>
            <button type="button" data-modal-hide="edit-modal" class="ms-3 text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" tabindex="-1" aria-hidden="true" class="hidden overflow-y-auto overflow-x-hidden fixed top-0 right-0 left-0 z-50 justify-center items-center w-full md:inset-0 h-[calc(100%-1rem)] max-h-full">
    <div class="relative p-4 w-full max-w-md max-h-full">
      <div class="relative bg-white rounded-lg shadow">
        <div class="p-4 md:p-5 text-center">
          <svg class="mx-auto mb-4 text-gray-400 w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v3m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <h3 class="mb-1 text-lg font-medium text-gray-900">Delete User</h3>
          <p class="mb-5 text-sm text-gray-500">Are you sure you want to delete <strong id="delete-user-name"></strong>? This action cannot be undone.</p>
          <button id="confirm-delete-btn" type="button" class="text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5">
            Yes, delete
          </button>
          <button type="button" data-modal-hide="delete-modal" class="ms-3 text-gray-500 bg-white hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 rounded-lg border border-gray-200 text-sm font-medium px-5 py-2.5">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="hidden fixed bottom-6 right-6 z-50 flex items-center w-full max-w-xs p-4 text-gray-500 bg-white rounded-lg shadow-lg border border-gray-200" role="alert">
    <div id="toast-icon" class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 rounded-lg"></div>
    <div id="toast-message" class="ms-3 text-sm font-normal"></div>
    <button type="button" onclick="hideToast()" class="ms-auto -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg p-1.5 hover:bg-gray-100 inline-flex items-center justify-center h-8 w-8">
      <svg class="w-3 h-3" fill="none" viewBox="0 0 14 14"><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/></svg>
    </button>
  </div>

  <!-- Footer -->
  <footer class="max-w-screen-xl mx-auto p-6 mt-8 border-t border-gray-200">
    <p class="text-sm text-gray-400">Built with Tailwind CSS &amp; Flowbite &mdash; AI Prototyping Workspace</p>
  </footer>

  <!-- Flowbite JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>

  <script>
    // -------------------------------------------------------
    // Data-driven table example
    // Fetches data.json and renders rows with search + filter
    // -------------------------------------------------------

    const tableBody = document.getElementById('user-table-body');
    const searchInput = document.getElementById('search-input');
    const roleFilter = document.getElementById('role-filter');
    const resultCount = document.getElementById('result-count');
    const emptyState = document.getElementById('empty-state');

    let allUsers = [];

    // Role badge color mapping
    const roleBadgeClasses = {
      'Admin':           'bg-purple-100 text-purple-800',
      'Designer':        'bg-blue-100 text-blue-800',
      'Developer':       'bg-green-100 text-green-800',
      'Product Manager': 'bg-yellow-100 text-yellow-800'
    };

    // Fetch data and render
    async function init() {
      try {
        const response = await fetch('data.json');
        const data = await response.json();
        allUsers = data.users;
        renderTable(allUsers);
      } catch (err) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="6" class="px-6 py-8 text-center text-red-500 text-sm">
              Failed to load data.json. Make sure you're running this from a local server (e.g. Live Server in VS Code), not opening the file directly.
            </td>
          </tr>`;
      }
    }

    // Render table rows
    function renderTable(users) {
      if (users.length === 0) {
        tableBody.innerHTML = '';
        emptyState.classList.remove('hidden');
        resultCount.textContent = '0 users';
        return;
      }

      emptyState.classList.add('hidden');
      resultCount.textContent = `${users.length} user${users.length !== 1 ? 's' : ''}`;

      tableBody.innerHTML = users.map(user => {
        const badgeClass = roleBadgeClasses[user.role] || 'bg-gray-100 text-gray-800';
        return `
          <tr class="bg-white border-b hover:bg-gray-50">
            <td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${escapeHtml(user.lastName)}</td>
            <td class="px-6 py-4">${escapeHtml(user.firstName)}</td>
            <td class="px-6 py-4">
              <code class="text-xs bg-gray-100 px-1.5 py-0.5 rounded">${escapeHtml(user.id)}</code>
            </td>
            <td class="px-6 py-4">${escapeHtml(user.email)}</td>
            <td class="px-6 py-4">
              <span class="${badgeClass} text-xs font-medium px-2.5 py-0.5 rounded">${escapeHtml(user.role)}</span>
            </td>
            <td class="px-6 py-4 text-right whitespace-nowrap">
              <button onclick="openEditModal('${user.id}')" class="font-medium text-blue-600 hover:underline text-sm">Edit</button>
              <span class="text-gray-300 mx-1">|</span>
              <button onclick="openDeleteModal('${user.id}')" class="font-medium text-red-600 hover:underline text-sm">Delete</button>
            </td>
          </tr>`;
      }).join('');
    }

    // Search and filter
    function applyFilters() {
      const query = searchInput.value.toLowerCase().trim();
      const role = roleFilter.value;

      const filtered = allUsers.filter(user => {
        const matchesRole = !role || user.role === role;
        const matchesSearch = !query ||
          user.lastName.toLowerCase().includes(query) ||
          user.firstName.toLowerCase().includes(query) ||
          user.email.toLowerCase().includes(query) ||
          user.id.toLowerCase().includes(query) ||
          user.role.toLowerCase().includes(query);
        return matchesRole && matchesSearch;
      });

      renderTable(filtered);
    }

    searchInput.addEventListener('input', applyFilters);
    roleFilter.addEventListener('change', applyFilters);

    // ----- Edit Modal -----
    const editModal = new Modal(document.getElementById('edit-modal'));

    function openEditModal(userId) {
      const user = allUsers.find(u => u.id === userId);
      if (!user) return;

      document.getElementById('edit-id').value = user.id;
      document.getElementById('edit-firstName').value = user.firstName;
      document.getElementById('edit-lastName').value = user.lastName;
      document.getElementById('edit-email').value = user.email;
      document.getElementById('edit-role').value = user.role;
      editModal.show();
    }

    document.getElementById('edit-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const id = document.getElementById('edit-id').value;
      const user = allUsers.find(u => u.id === id);
      if (!user) return;

      user.firstName = document.getElementById('edit-firstName').value;
      user.lastName = document.getElementById('edit-lastName').value;
      user.email = document.getElementById('edit-email').value;
      user.role = document.getElementById('edit-role').value;

      editModal.hide();
      applyFilters();
      showToast('success', `${user.firstName} ${user.lastName} updated.`);
    });

    // ----- Delete Modal -----
    const deleteModal = new Modal(document.getElementById('delete-modal'));
    let pendingDeleteId = null;

    function openDeleteModal(userId) {
      const user = allUsers.find(u => u.id === userId);
      if (!user) return;

      pendingDeleteId = userId;
      document.getElementById('delete-user-name').textContent = `${user.firstName} ${user.lastName}`;
      deleteModal.show();
    }

    document.getElementById('confirm-delete-btn').addEventListener('click', function() {
      if (!pendingDeleteId) return;
      const user = allUsers.find(u => u.id === pendingDeleteId);
      const name = user ? `${user.firstName} ${user.lastName}` : 'User';

      allUsers = allUsers.filter(u => u.id !== pendingDeleteId);
      pendingDeleteId = null;

      deleteModal.hide();
      applyFilters();
      showToast('delete', `${name} deleted.`);
    });

    // ----- Toast -----
    let toastTimeout;

    function showToast(type, message) {
      const toast = document.getElementById('toast');
      const icon = document.getElementById('toast-icon');
      const msg = document.getElementById('toast-message');

      if (type === 'success') {
        icon.className = 'inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-green-500 bg-green-100 rounded-lg';
        icon.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5Zm3.707 8.207-4 4a1 1 0 0 1-1.414 0l-2-2a1 1 0 0 1 1.414-1.414L9 10.586l3.293-3.293a1 1 0 0 1 1.414 1.414Z"/></svg>';
      } else {
        icon.className = 'inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-red-500 bg-red-100 rounded-lg';
        icon.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM10 15a1 1 0 1 1 0-2 1 1 0 0 1 0 2Zm1-4a1 1 0 0 1-2 0V6a1 1 0 0 1 2 0v5Z"/></svg>';
      }

      msg.textContent = message;
      toast.classList.remove('hidden');
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(hideToast, 3000);
    }

    function hideToast() {
      document.getElementById('toast').classList.add('hidden');
    }

    // ----- Helpers -----
    function escapeHtml(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // Start
    init();
  </script>
</body>
</html>
